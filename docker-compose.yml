services:
  dvwa:
    image: vulnerables/web-dvwa
    platform: linux/amd64
    ports:
      - "8080:80"
    environment:
      - MYSQL_ROOT_PASSWORD=password
    networks:
      - labnet

  mutillidae:
    image: citizenstig/nowasp
    platform: linux/amd64
    ports:
      - "8081:80"
    networks:
      - labnet

  juice-shop:
    image: bkimminich/juice-shop
    ports:
      - "3000:3000"
    networks:
      - labnet

  vuln-server:
    image: arm64v8/ubuntu:22.04
    container_name: vuln-server
    command: >
      bash -c "
        apt update &&
        DEBIAN_FRONTEND=noninteractive apt install -y openssh-server netcat-traditional &&
        mkdir -p /var/run/sshd &&
        echo 'root:toor' | chpasswd &&
        sed -i 's/^#*PermitRootLogin.*/PermitRootLogin yes/' /etc/ssh/sshd_config &&
        service ssh start &&
        while true; do
          nc -lvnp 4444 -e /bin/bash;
        done
      "
    ports:
      - "2222:22"
      - "4444:4444"
    networks:
      - labnet

  kali:
    build:
      context: .
      dockerfile: Dockerfile.kali
    container_name: kali-attacker
    tty: true
    stdin_open: true
    working_dir: /root
    command: tail -f /dev/null
    volumes:
      - ./loot:/root/loot
    networks:
      labnet:
        ipv4_address: 172.20.0.10

networks:
  labnet:
    driver: bridge
    ipam:
      config:
        - subnet: 172.20.0.0/16

